# Metricx Project Documentation

> Auto-generated by BMad Document-Project workflow on 2025-12-11
>
> This documentation provides AI agents with comprehensive context about the Metricx codebase for accurate code generation and modification.

## Project Overview

**Metricx** is an AI-powered marketing analytics platform that helps merchants understand and optimize their ad spend. The platform provides:

- **Dashboard** - Ad performance, spend, ROAS, AI insights
- **Analytics** - Deep dive, campaign comparisons, trends
- **Copilot** - Natural language queries about ad data
- **Campaigns** - Monitor and manage campaigns
- **Finance** - P&L and profitability view

**Vision:** Natural language → Precise insights. No learning curve.

## Quick Reference

| Aspect | Details |
|--------|---------|
| **Project Type** | Multi-part (Backend + Frontend + Shopify App) |
| **Backend** | Python 3.11, FastAPI, SQLAlchemy, PostgreSQL |
| **Frontend** | Next.js 15, React 19, JavaScript, Tailwind CSS |
| **Auth** | Clerk (RS256 JWT) |
| **AI** | Anthropic Claude (via LangGraph) |
| **Deployment** | Defang (`defang compose up`) |
| **Domain** | metricx.ai |

## Documentation Index

### Core Documentation (Generated)

| Document | Description |
|----------|-------------|
| [architecture.md](./architecture.md) | System architecture, tech stack, data flows |
| [data-models.md](./data-models.md) | Database schema, relationships, enums |
| [api-reference.md](./api-reference.md) | REST API endpoints, request/response formats |

### Existing Documentation (docs-arch/)

| Document | Description |
|----------|-------------|
| [ARCHITECTURE.md](../docs-arch/living-docs/ARCHITECTURE.md) | Original system overview |
| [AUTH.md](../docs-arch/living-docs/AUTH.md) | Clerk authentication details |
| [ARQ_WORKERS.md](../docs-arch/living-docs/ARQ_WORKERS.md) | Background job processing |
| [QA_SYSTEM_ARCHITECTURE.md](../docs-arch/living-docs/QA_SYSTEM_ARCHITECTURE.md) | AI Copilot architecture |
| [METRIC_SNAPSHOTS.md](../docs-arch/living-docs/METRIC_SNAPSHOTS.md) | 15-min metrics system |
| [OBSERVABILITY.md](../docs-arch/living-docs/OBSERVABILITY.MD) | Monitoring stack |
| [ATTRIBUTION_ENGINE.md](../docs-arch/living-docs/ATTRIBUTION_ENGINE.md) | Order attribution |

### Integration Documentation

| Document | Description |
|----------|-------------|
| [META_OAUTH_IMPLEMENTATION.md](../docs-arch/meta-ads-lib/META_OAUTH_IMPLEMENTATION.md) | Meta Ads OAuth |
| [GOOGLE_OAUTH_IMPLEMENTATION.md](../docs-arch/google-ads-lib/GOOGLE_OAUTH_IMPLEMENTATION.md) | Google Ads OAuth |
| [RATE_LIMIT_GUIDE.md](../docs-arch/meta-ads-lib/RATE_LIMIT_GUIDE.md) | API rate limiting |

## Development Quick Start

```bash
# Backend
cd backend
python -m venv venv && source venv/bin/activate
pip install -r requirements.txt
alembic upgrade head
python start_api.py

# Worker (separate terminal)
arq app.workers.arq_worker.WorkerSettings

# Frontend (separate terminal)
cd ui
npm install && npm run dev
```

Access: http://localhost:3000

## Key Directories

```
metricx/
├── backend/
│   ├── app/
│   │   ├── routers/      # API endpoints
│   │   ├── services/     # Business logic
│   │   ├── agent/        # LangGraph AI agent
│   │   ├── semantic/     # Composable query layer
│   │   ├── workers/      # Background jobs
│   │   └── models.py     # Database models
│   └── alembic/          # Migrations
├── ui/
│   ├── app/(dashboard)/  # Protected routes
│   ├── components/       # React components
│   └── lib/              # API clients
├── shopify-app/          # Shopify extension
└── docs/                 # This documentation
```

## Environment Variables

### Required
- `DATABASE_URL` - PostgreSQL connection
- `REDIS_URL` - Redis connection
- `CLERK_SECRET_KEY`, `CLERK_PUBLISHABLE_KEY` - Auth
- `ANTHROPIC_API_KEY` - AI

### Optional (Integrations)
- `META_APP_ID`, `META_APP_SECRET` - Meta Ads
- `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` - Google Ads
- `SHOPIFY_API_KEY`, `SHOPIFY_API_SECRET` - Shopify

### Observability
- `SENTRY_DSN` - Error tracking
- `LANGFUSE_PUBLIC_KEY`, `LANGFUSE_SECRET_KEY` - LLM tracing

## BMM Workflow Status

This project uses BMad Method for planning. Current workflow status tracked in:
- [bmm-workflow-status.yaml](./bmm-workflow-status.yaml)

Next planned features:
1. **Rule Engine** - Notifications when conditions met (spend > X, ROAS drops)
2. **User Context** - Capture website, goals for better AI context

## AI Agent Guidelines

When working with this codebase:

1. **Backend changes** - Follow FastAPI patterns, use dependency injection via `deps.py`
2. **Database changes** - Create Alembic migration, update `models.py`
3. **Frontend changes** - Use JavaScript (not TypeScript), follow existing component patterns
4. **API changes** - Update router, add Pydantic schema, document endpoint
5. **AI/Semantic changes** - Update `semantic/` layer, test with QA golden tests

## Testing

```bash
# Backend
cd backend && pytest

# Frontend
cd ui && npm test

# QA Golden Tests (DeepEval)
cd backend && pytest app/tests/qa_evaluation/
```

---

*Last updated: 2025-12-11*
